(function(){function t(t,a,i,r){function h(){(B="object"==typeof i?i:a.src||r?o:document.createElement("canvas")).width=g,B.height=s,G=B.getContext("2d")}function n(t){if(t){var e,a=G.getImageData(0,0,g,s),i=a.data;for(e=0;e<at;e+=4)i[e]=t[e]*it|0,i[e+1]=t[e+1]*it|0,i[e+2]=t[e+2]*it|0,i[e+3]=t[e+3]*it|0;return delete t,a}return G.getImageData(0,0,g,s)}a||(a=t.input,i=t.output,r=t.inputRemovable,t.scale&&(t=t.scale));var o,u;if(a.src)if(o=document.createElement("canvas"),null!=a.naturalWidth)o.width=a.naturalWidth,o.height=a.naturalHeight;else if(null!=a.runtimeStyle){var d=a.runtimeStyle,l=d.width,c=d.height;d.width="auto",d.height="auto",o.width=a.width,o.height=a.height,d.width=l,d.height=c}else{l=a.width,c=a.height;a.removeAttribute&&(a.removeAttribute("width"),a.removeAttribute("height")),o.width=a.width,o.height=a.height,a.width=l,a.height=c}else o=a;u=o.getContext("2d"),a.src&&u.drawImage(a,0,0);var g,s,f=o.width,m=o.height,w=u.getImageData(0,0,f,m).data;if(!f||!m)return!1;(a.src||r)&&u.clearRect(0,0,f,m),"object"==typeof t?t.width?(g=t.width+.5|0,s=t.height+.5|0):(g=f*t.scaleX+.5|0,s=m*t.scaleY+.5|0):(g=t*f+.5|0,s=t*m+.5|0);var p,v,b,y,x,D,I,A,j,R,k,C,E,F,L,S,U,W,H,X,Y,q,z,B,G,J,K,M,N,O,P,Q,T,V,Z,$=g<<2,_=f<<2,tt=0,et=0,at=$*s,it=255.99/255,rt=g/f,ht=s/m,nt=rt*ht;if(rt>1||ht>1){function ot(t,e,a,i,r){return.5*(i-e+(2*e-5*a+4*i-r+(3*(a-i)+r-e)*t)*t)*t+a}for(h(),K=(J=n()).data,y=0;y<s;y++)for(q=(v=y/ht)-(j=0|v),N=j*_,M=j<1?N:N-_,j<m-2?(O=N+_,P=(j+2)*_):O=P=j>m-2?N:N+_,b=0;b<g;b++,et+=4)z=(p=b/rt)-(A=0|p),T=A<<2,Q=A<1?T:T-4,A<f-2?(V=T+4,Z=T+8):V=Z=A>f-2?T:T+4,W=ot(q,ot(z,w[M+Q],w[M+T],w[M+V],w[M+Z]),ot(z,w[N+Q],w[N+T],w[N+V],w[N+Z]),ot(z,w[O+Q],w[O+T],w[O+V],w[O+Z]),ot(z,w[P+Q],w[P+T],w[P+V],w[P+Z]))*it|0,++T,++V,++Z,H=ot(q,ot(z,w[M+ ++Q],w[M+T],w[M+V],w[M+Z]),ot(z,w[N+Q],w[N+T],w[N+V],w[N+Z]),ot(z,w[O+Q],w[O+T],w[O+V],w[O+Z]),ot(z,w[P+Q],w[P+T],w[P+V],w[P+Z]))*it|0,++T,++V,++Z,X=ot(q,ot(z,w[M+ ++Q],w[M+T],w[M+V],w[M+Z]),ot(z,w[N+Q],w[N+T],w[N+V],w[N+Z]),ot(z,w[O+Q],w[O+T],w[O+V],w[O+Z]),ot(z,w[P+Q],w[P+T],w[P+V],w[P+Z]))*it|0,K[et]=W>=0?W<256?W:255:0,K[et+1]=H>=0?H<256?H:255:0,K[et+2]=X>=0?X<256?X:255:0,++T,++V,++Z,Y=ot(q,ot(z,w[M+ ++Q],w[M+T],w[M+V],w[M+Z]),ot(z,w[N+Q],w[N+T],w[N+V],w[N+Z]),ot(z,w[O+Q],w[O+T],w[O+V],w[O+Z]),ot(z,w[P+Q],w[P+T],w[P+V],w[P+Z]))*it|0,K[et+3]=Y>=0?Y<256?Y:255:0}else{if(e.Float32Array)U=new Float32Array(at);else for(U=[],et=0;et<at;++et)U[et]=0;for(v=0;v<m;v++)for(x=(I=0|(y=v*ht))*$,(S=!!((I-(y+ht|0))*(m-1-v))<<1)&&(E=I+1-y,F=y+ht-I-1),p=0;p<f;p++,tt+=4)switch(b=p*rt,D=0|b,et=x+(D<<2),(L=!!((D-(b+rt|0))*(f-1-p)))&&(k=D+1-b,C=b+rt-D-1),W=w[tt],H=w[tt+1],X=w[tt+2],Y=w[tt+3],L+S){case 0:U[et]+=W*nt,U[et+1]+=H*nt,U[et+2]+=X*nt,U[et+3]+=Y*nt;break;case 1:R=k*ht,U[et]+=W*R,U[et+1]+=H*R,U[et+2]+=X*R,U[et+3]+=Y*R,R=C*ht,U[et+4]+=W*R,U[et+5]+=H*R,U[et+6]+=X*R,U[et+7]+=Y*R;break;case 2:R=rt*E,U[et]+=W*R,U[et+1]+=H*R,U[et+2]+=X*R,U[et+3]+=Y*R,R=rt*F,U[et+=$]+=W*R,U[et+1]+=H*R,U[et+2]+=X*R,U[et+3]+=Y*R;break;default:R=k*E,U[et]+=W*R,U[et+1]+=H*R,U[et+2]+=X*R,U[et+3]+=Y*R,R=C*E,U[et+4]+=W*R,U[et+5]+=H*R,U[et+6]+=X*R,U[et+7]+=Y*R,R=k*F,U[et+=$]+=W*R,U[et+1]+=H*R,U[et+2]+=X*R,U[et+3]+=Y*R,R=C*F,U[et+4]+=W*R,U[et+5]+=H*R,U[et+6]+=X*R,U[et+7]+=Y*R}delete w,h(),J=n(U)}if(G.putImageData(J,0,0),"string"==typeof i){if("png"===i||"jpeg"===i){var ut;return ut=r&&a.src?a:new Image,ut.width=g,ut.height=s,ut.src=B.toDataURL("image/"+i,1),ut}if("png-src"===i||"jpeg-src"===i)return B.toDataURL("image/"+i.split("-")[0],1)}return B}var e=this;"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.scale=t):e.scale=t}).call(this);